---
import TrainLogo from './TrainLogo.astro';
import { Counter } from './Counter';
import { onMount } from 'svelte';

let counter = 0;

onMount(() => {
    // Listen for messages from React component
    window.addEventListener('message', handleMessage);

    return () => {
        // Clean up event listener on component destruction
        //window.removeEventListener('message', handleMessage);
    };
});

function handleMessage(event: MessageEvent) {
    console.log("Entra");
    const { data } = event;
    if (data.type === 'UPDATE_COUNTER') {
        // Update counter value
        counter = data.counter;
    }
}

---

<div class="mx-auto text-center h-[100vh] bg-image pt-14 flex flex-col justify-center">
    
    <!-- Content -->
    <div class="relative z-10 flex flex-col justify-center items-center">

        <h2 class="mb-4 text-5xl tracking-tight font-extrabold text-white title-font flex items-center">
            <span>ENTRETRENES</span>
            <span class="ml-2"><TrainLogo width="30"/></span>
        </h2>
        <p class="font-normal text-gray-50 sm:text-xl dark:text-gray-300">
            Los mejores trenes a los mejores precios
        </p>

        <form class="w-full max-w-4xl mt-10">

            <!--First row -->
            <div class="flex flex-wrap -mx-3 mb-6">
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <div class="relative">
                        <input type="text" id="departure_station" class="block rounded-3xl px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-600 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " />
                        <label for="departure_station" class="pl-5 absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Origen</label>
                    </div>
                </div>
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <div class="relative">
                        <input type="date" id="departure_date" class="block rounded-3xl px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-600 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " />
                        <label for="departure_date" class="pl-5 absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Fecha de ida</label>
                    </div>
                </div>
            </div>
            <div class="flex flex-wrap -mx-3 mb-6">
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <div class="relative">
                        <input type="text" id="return_station" class="block rounded-3xl px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-600 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " />
                        <label for="return_station" class="pl-5 absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Destino</label>
                    </div>
                </div>
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <div class="relative">
                        <input type="date" id="departure_date" class="block rounded-3xl px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-600 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " />
                        <label for="departure_date" class="pl-5 absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Fecha de vuelta</label>
                    </div>
                </div>
            </div>
            <div class="flex flex-wrap -mx-3">
                <div class="w-full md:w-2/4 px-3 mb-6 md:mb-0">
                    <button data-popover-target="passengers-popover" data-popover-placement="bottom" type="button" class="flex-row justify-center text-white cursor-pointer hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-400 font-medium rounded-3xl px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-green-400 mr-2 hover:shadow-lg transition-all duration-200 ease-in-out hover:scale-110 scale-90 gap-x-2 opacity-90 hover:opacity-100 border border-green-400">
                        <svg class="icon icon-tabler icon-tabler-man" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 16v5" /><path d="M14 16v5" /><path d="M9 9h6l-1 7h-4z" /><path d="M5 11c1.333 -1.333 2.667 -2 4 -2" /><path d="M19 11c-1.333 -1.333 -2.667 -2 -4 -2" /><path d="M12 4m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /></svg>                        
                        Viajeros: {counter} adultos | {counter} niños
                        <svg class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg>                    
                    </button>
                    <div data-popover id="passengers-popover" role="tooltip" class="absolute p-3 z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                        <!-- Pasajeros adultos -->
                        <div class="flex justify-between items-center mb-2">
                            <Counter ageData="adult" initialNumber="1" client:visible />
                            <label for="adult-passengers" class="inline-block text-sm font-medium text-gray-900 dark:text-white"> adultos</label>
                        </div>
                        
                        <hr>

                        <!-- Pasajeros niños -->
                        <div class="flex justify-between items-center mt-2">
                            <Counter ageData="kid" initialNumber="0" client:visible />
                            <label for="kids-passengers" class="inline-block text-sm font-medium text-gray-900 dark:text-white"> niños (0-13)</label>
                        </div>


                        <div data-popper-arrow></div>
                    </div>
                </div>
                <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0 flex items-center">
                    <input id="default-checkbox" type="checkbox" value="" class="w-4 h-4 text-green-500 bg-gray-100 rounded focus:ring-green-500 dark:focus:ring-green-500 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 border border-green-400">
                    <svg class="ml-2 icon icon-tabler icon-tabler-wheelchair" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 16m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" /><path d="M19 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M19 17a3 3 0 0 0 -3 -3h-3.4" /><path d="M3 3h1a2 2 0 0 1 2 2v6" /><path d="M6 8h11" /><path d="M15 8v6" /></svg>
                    <label for="default-checkbox" class="ms-2 text-sm font-medium text-gray-300 dark:text-gray-300">Movilidad reducida</label>
                </div>
                <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
                    <button data-popover-target="popover-bottom" data-popover-placement="bottom" type="button" class="flex-row justify-center text-white cursor-pointer hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-400 font-medium rounded-3xl px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 hover:shadow-lg transition-all duration-200 ease-in-out hover:scale-110 scale-90 gap-x-2 opacity-90 hover:opacity-100 border border-green-400">
                        <svg class="icon icon-tabler icon-tabler-discount-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 15l6 -6" /><circle cx="9.5" cy="9.5" r=".5" fill="#ffffff" /><circle cx="14.5" cy="14.5" r=".5" fill="#ffffff" /><path d="M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7a2.2 2.2 0 0 0 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1a2.2 2.2 0 0 0 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1" /></svg>
                        Descuento
                        <svg class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg>                    
                    </button>
                    <div data-popover id="popover-bottom" role="tooltip" class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                        <div class="px-3 py-2 bg-gray-100 border-b border-gray-200 rounded-t-lg dark:border-gray-600 dark:bg-gray-700">
                            <h3 class="font-semibold text-gray-900 dark:text-white text-left">Introduce tu código de descuento</h3>
                        </div>
                        <div class="px-3 py-2">
                            <div class="relative">
                                <input type="text" id="discount_code" class="block rounded-3xl px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-600 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " />
                                <label for="discount_code" class="pl-5 absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Código</label>
                            </div>
                        </div>
                        <div data-popper-arrow></div>
                    </div>
                </div>
            </div>

            <a href="/search-1" class="mt-5 flex-row justify-center text-white cursor-pointer hover:bg-green-950 focus:ring-4 focus:outline-none focus:ring-green-950 font-medium rounded-3xl px-56 py-2.5 text-center inline-flex items-center dark:focus:ring-green-950 mr-2 hover:shadow-lg transition-all duration-200 ease-in-out hover:scale-110 scale-90 gap-x-2 opacity-90 hover:opacity-100 border border-green-700 bg-green-800">
                Buscar
            </a>
          </form>
          
    </div>
</div>

<style>
    .title-font {
        font-family: 'Helios', sans-serif;
        letter-spacing: 3px;
    }

    .bg-image {
        background-image: url('../images/train-bg.png');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    input[type="text"] {
        padding-left: 25px;
    }

    input[type="text"].counter-passengers {
        padding-left: 15px;
    }
    

    input[type="date"] {
        padding-left: 25px;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        margin-top: -9px;
    }

</style>